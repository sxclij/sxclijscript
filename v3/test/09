main()
eternal_sleep()

fn breakpoint() (
    ext(5)
)
fn putc(ch) (
    &result = ext(ch, 6)
)
fn erase_all() (
    ext(9)
)
fn stamp() (
    ext(10)
)
fn pen_down() (
    ext(11)
)
fn pen_up() (
    ext(12)
)
fn pen_color_set(x) (
    &result = ext(x, 13)
)
fn pen_size_set(x) (
    &result = ext(x, 14)
)
fn goto(x, y) (
    &result = ext(x, y, 15)
)

fn eternal_sleep() (
    loop (
        &status = usleep(0)
    )
)
fn _allocate(dst, size) (
    &x = *3 - 2
    x = *x + size + 2
    dst = x
)
fn swap(a, b) (
    &t = *a
    a = *b
    b = t
)
fn print_endl() (
    putc(10)
)
fn print_int(x) (
    &m = 1000000000
    if (x < 0) (
        putc(45)
        &x = x * -1
    ) else if (x == 0) (
        putc(48)
        return(0)
    )
    loop (
        if (x / m > 0) (
            break
        )
        &m = m / 10
    )
    loop (
        if (m == 0) (
            return(0)
        )
        putc(x / m % 10 + 48)
        &m = m / 10
    )
)
fn vec_init(v) (
    v = 0
)
fn vec_size(v) (
    return (*v)
)
fn vec_get(v, i) (
    return (*(v + i + 1))
)
fn vec_provide(v, i) (
    return (v + i + 1)
)
fn vec_set(v, i, x) (
    v + i + 1 = x
)
fn vec_push(v, x) (
    v = *v + 1
    v + *v = x
)
fn vec_pop(v) (
    &result = v + *v
    v = *v - 1
    return (result)
)
fn obj_pos_y_get(obj) (
    return (*(obj + 11))
)
fn obj_pos_x_get(obj) (
    return (*(obj + 12))
)
fn obj_pos_set(obj, x, y) (
    obj + 11 = x
    obj + 12 = y
)
fn obj_size_set(obj, x) (
    obj + 14 = x
)
fn obj_dir_set(obj, x) (
    obj + 15 = x
)
fn obj_costume_set(obj, x) (
    obj + 16 = x
)
fn obj_collision_set(obj, size_x, size_y) (
    &obj_collision = *132
    &status = vec_push(obj_collision, obj)
    &status = vec_push(obj_collision, size_x)
    &status = vec_push(obj_collision, size_y)
    &status = vec_push(obj_collision, 0)
)
fn obj_spawn() (
    &obj_clone = *130
    &obj_free = *131
    &result = vec_pop(obj_free)
    &status = vec_push(obj_clone, result)
    return (result)
)
fn obj_init(obj_data, obj_clone, obj_free, obj_collision) (
    &status = vec_init(obj_clone)
    &status = vec_init(obj_free)
    &status = vec_init(obj_collision)
    129 = obj_data
    130 = obj_clone
    131 = obj_free
    132 = obj_collision
    &i = 0
    loop (
        if(i == 300) (
            break
        )
        &status = vec_push(obj_free, obj_data + i * 128)
        &i = i + 1
    )
)

fn main() (

    _allocate(&obj_data, 128 * 300)
    _allocate(&obj_clone, 300 + 2)
    _allocate(&obj_free, 300 + 2)
    _allocate(&obj_collision, 10 * 50 + 2)
    
    obj_init(obj_data, obj_clone, obj_free, obj_collision)

    &ui_start = obj_spawn()
    &status = obj_collision_set(ui_start, 160, 38)
    &status = obj_pos_set(ui_start, 0, 0)
    &status = obj_size_set(ui_start, 100)
    &status = obj_costume_set(ui_start, 2)

    loop (
        &utc_now = *33
        &mouse_isdown = *34
        &mouse_x = *35
        &mouse_y = *36

        &collision_i = 0
        loop (
            if (collision_i == vec_size(obj_collision)) (
                break
            )
            &obj = vec_get(obj_collision, collision_i + 0)
            &x = obj_pos_x_get(obj)
            &y = obj_pos_y_get(obj)
            &dx = vec_get(obj_collision, collision_i + 1) / 2
            &dy = vec_get(obj_collision, collision_i + 2) / 2
            print_int(obj)
            print_endl()
            print_int(dx)
            print_endl()
            print_int(vec_get(obj_collision, collision_i + 2) / 2)
            print_endl()
            if (mouse_isdown && mouse_x > x - dx && mouse_x < x + dx && mouse_y > y - dy && mouse_y < y + dy) (
                &status = obj_size_set(obj, 110)
            ) else (
                &status = obj_size_set(obj, 100)
            )
            &collision_i = collision_i + 4
        )


        &status = erase_all()
        
        &status = usleep(0)
    )
)